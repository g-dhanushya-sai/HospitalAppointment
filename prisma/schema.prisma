generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  PATIENT
  DOCTOR
  HOSPITAL_ADMIN
  ADMIN
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  REJECTED
}

model User {
  id         String   @id @default(uuid())
  email      String   @unique
  password   String
  name       String?
  role       Role     @default(PATIENT)
  hospitalId String?  // for hospital admins
  hospital   Hospital? @relation(fields: [hospitalId], references: [id])
  createdAt  DateTime @default(now())
  doctor     Doctor?
  appointments Appointment[] @relation("PatientAppointments")
  notifications Notification[]
  auditLogs   AuditLog[]
}

model Doctor {
  id          String   @id @default(uuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id])
  hospitalId  String
  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  departmentId String
  department  Department @relation(fields: [departmentId], references: [id])
  bio         String?
  timeSlots   TimeSlot[]
  appointments Appointment[] @relation("DoctorAppointments")
}

model Hospital {
  id          String   @id @default(uuid())
  name        String
  address     String?
  admins      User[]   // hospital admins
  departments Department[]
  doctors     Doctor[]
}

model Department {
  id         String   @id @default(uuid())
  name       String
  hospitalId String
  hospital   Hospital @relation(fields: [hospitalId], references: [id])
  doctors    Doctor[]
}

model TimeSlot {
  id        String   @id @default(uuid())
  doctorId  String
  doctor    Doctor   @relation(fields: [doctorId], references: [id])
  start     DateTime
  end       DateTime
  createdAt DateTime @default(now())
  appointments Appointment[]
}

model Appointment {
  id         String   @id @default(uuid())
  patientId  String
  patient    User     @relation("PatientAppointments", fields: [patientId], references: [id])
  doctorId   String
  doctor     Doctor   @relation("DoctorAppointments", fields: [doctorId], references: [id])
  timeSlotId String   @unique
  timeSlot   TimeSlot @relation(fields: [timeSlotId], references: [id])
  status     AppointmentStatus @default(PENDING)
  reason     String
  createdAt  DateTime @default(now())
}

model AuditLog {
  id        String   @id @default(uuid())
  userId    String?
  user      User?    @relation(fields: [userId], references: [id])
  action    String
  payload   Json?
  createdAt DateTime @default(now())
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
}
